<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambridge Stage 4 Math Worksheet Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #4a6ee0;
            padding-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        .tab.active {
            color: #4a6ee0;
            border-bottom: 3px solid #4a6ee0;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        button {
            background-color: #4a6ee0;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        button:hover {
            background-color: #3a5bc7;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .worksheet {
            margin-top: 30px;
            padding: 30px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            background-color: white;
        }
        .question {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #e1e4e8;
        }
        .question-number {
            font-weight: bold;
            margin-bottom: 10px;
            color: #4a6ee0;
        }
        .question-text {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .options {
            margin-left: 20px;
        }
        .option {
            margin-bottom: 8px;
        }
        .answer-input {
            width: 200px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
        }
        .unit-header {
            background-color: #e8edff;
            padding: 15px;
            border-radius: 8px;
            margin: 30px 0 20px;
            font-weight: bold;
            color: #2c3e50;
            border-left: 5px solid #4a6ee0;
        }
        .hidden {
            display: none;
        }
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        #printBtn {
            background-color: #27ae60;
        }
        #printBtn:hover {
            background-color: #219653;
        }
        #checkAnswersBtn {
            background-color: #e67e22;
        }
        #checkAnswersBtn:hover {
            background-color: #d35400;
        }
        #viewScoresBtn {
            background-color: #9b59b6;
        }
        #viewScoresBtn:hover {
            background-color: #8e44ad;
        }
        #downloadBtn {
            background-color: #3498db;
        }
        #downloadBtn:hover {
            background-color: #2980b9;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .feedback {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .score-display {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background-color: #e8f4fd;
            border-radius: 8px;
            border: 1px solid #b8daff;
        }
        .scores-container {
            margin-top: 20px;
        }
        .score-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4a6ee0;
        }
        .score-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .score-topic {
            font-weight: bold;
            color: #2c3e50;
        }
        .score-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .score-details {
            display: flex;
            justify-content: space-between;
        }
        .score-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #4a6ee0;
        }
        .no-scores {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-style: italic;
        }
        .user-info {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .user-input {
            flex: 1;
        }
        .error-message {
            color: #e74c3c;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        /* Image styles */
        .question-image {
            max-width: 100%;
            height: auto;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .number-line {
            width: 100%;
            max-width: 500px;
            height: 60px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            position: relative;
            margin: 15px 0;
        }
        
        .number-line-mark {
            position: absolute;
            bottom: 0;
            width: 1px;
            height: 20px;
            background-color: #333;
        }
        
        .number-line-label {
            position: absolute;
            bottom: -25px;
            text-align: center;
            width: 30px;
            left: -15px;
        }
        
        .grid-coordinates {
            width: 300px;
            height: 300px;
            background-color: #f8f9fa;
            border: 1px solid #333;
            position: relative;
            margin: 15px 0;
        }
        
        .grid-line {
            position: absolute;
            background-color: #ddd;
        }
        
        .grid-line.vertical {
            width: 1px;
            height: 100%;
        }
        
        .grid-line.horizontal {
            width: 100%;
            height: 1px;
        }
        
        .grid-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #4a6ee0;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .grid-label {
            position: absolute;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .grid-label.x-axis {
            bottom: -20px;
        }
        
        .grid-label.y-axis {
            left: -20px;
        }
        
        .shape-diagram {
            width: 150px;
            height: 150px;
            margin: 15px 0;
            border: 1px solid #333;
        }
        
        .fraction-diagram {
            width: 200px;
            height: 100px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            position: relative;
            margin: 15px 0;
            display: flex;
        }
        
        .fraction-part {
            flex: 1;
            border-right: 1px solid #ddd;
        }
        
        .fraction-part:last-child {
            border-right: none;
        }
        
        .fraction-part.shaded {
            background-color: #4a6ee0;
        }
        
        .thermometer {
            width: 60px;
            height: 200px;
            background: linear-gradient(to top, #4a6ee0 0%, #e74c3c 100%);
            border: 2px solid #333;
            border-radius: 30px;
            position: relative;
            margin: 15px 0;
        }
        
        .thermometer-mercury {
            position: absolute;
            bottom: 0;
            width: 100%;
            background-color: #e74c3c;
            border-radius: 0 0 28px 28px;
        }
        
        .thermometer-mark {
            position: absolute;
            left: -20px;
            width: 15px;
            height: 1px;
            background-color: #333;
        }
        
        .thermometer-label {
            position: absolute;
            left: -40px;
            transform: translateY(-50%);
            font-size: 0.8rem;
        }
        
        .symmetry-line {
            position: absolute;
            background-color: #e74c3c;
            height: 2px;
            width: 100%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .symmetry-line.vertical {
            width: 2px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
            top: 0;
        }
        
        .symmetry-line.diagonal {
            width: 2px;
            height: 141%;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            top: -20%;
        }
        
        .symmetry-line.diagonal-2 {
            width: 2px;
            height: 141%;
            left: 50%;
            transform: translateX(-50%) rotate(-45deg);
            top: -20%;
        }
        
        /* PDF-specific styles */
        .pdf-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .pdf-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a6ee0;
        }
        
        .pdf-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .pdf-subtitle {
            font-size: 16px;
            color: #7f8c8d;
        }
        
        .pdf-student-info {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .pdf-worksheet {
            padding: 20px;
        }
        
        .pdf-question {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }
        
        .pdf-question-number {
            font-weight: bold;
            margin-bottom: 8px;
            color: #4a6ee0;
        }
        
        .pdf-question-text {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .pdf-answer-space {
            height: 25px;
            border-bottom: 1px solid #ddd;
            margin-top: 10px;
        }
        
        @media print {
            .controls, .actions, footer, .feedback, .score-display, .tabs {
                display: none;
            }
            .worksheet {
                border: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cambridge Stage 4 Math Worksheet Generator</h1>
            <p class="subtitle">Based on Cambridge Primary Progression Tests (2014-2023)</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="worksheet">Worksheet</div>
            <div class="tab" data-tab="scores">Score History</div>
        </div>
        
        <div class="tab-content active" id="worksheet-tab">
            <div class="user-info">
                <div class="user-input">
                    <label for="userName">Student Name:</label>
                    <input type="text" id="userName" placeholder="Enter your name" required>
                    <div class="error-message hidden" id="nameError">Please enter your name to generate the worksheet.</div>
                </div>
                <div class="user-input">
                    <label for="userId">Student ID (optional):</label>
                    <input type="text" id="userId" placeholder="Enter student ID">
                </div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="topic">Select Topic:</label>
                    <select id="topic">
                        <option value="all">All Topics</option>
                        <option value="number">Number & Place Value</option>
                        <option value="sequences">Sequences & Patterns</option>
                        <option value="fractions">Fractions</option>
                        <option value="geometry">Geometry & Shapes</option>
                        <option value="measurement">Measurement</option>
                        <option value="statistics">Statistics & Probability</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="difficulty">Difficulty Level:</label>
                    <select id="difficulty">
                        <option value="all">All Levels</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="questionCount">Number of Questions:</label>
                    <input type="number" id="questionCount" min="5" max="50" value="20">
                </div>
                
                <div class="control-group">
                    <label for="year">Test Year:</label>
                    <select id="year">
                        <option value="all">All Years</option>
                        <option value="2014">2014</option>
                        <option value="2018">2018</option>
                        <option value="2020">2020</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <button id="generateBtn">Generate Worksheet</button>
                </div>
            </div>
            
            <div class="worksheet hidden" id="worksheet">
                <!-- Worksheet content will be generated here -->
            </div>
            
            <div class="score-display hidden" id="scoreDisplay">
                <!-- Score will be displayed here -->
            </div>
            
            <div class="actions">
                <button id="checkAnswersBtn" class="hidden">Check Answers</button>
                <button id="downloadBtn" class="hidden">Download as PDF</button>
                <button id="printBtn" class="hidden">Print Worksheet</button>
                <button id="viewScoresBtn">View Score History</button>
            </div>
        </div>
        
        <div class="tab-content" id="scores-tab">
            <h2>Score History</h2>
            <div class="scores-container" id="scoresContainer">
                <!-- Score history will be displayed here -->
            </div>
        </div>
        
        <footer>
            <p>Cambridge Stage 4 Math Worksheet Generator &copy; 2025</p>
        </footer>
    </div>

    <script>
        // Backend simulation using localStorage
        class ScoreTracker {
            constructor() {
                this.storageKey = 'mathWorksheetScores';
                this.scores = this.loadScores();
            }
            
            loadScores() {
                const stored = localStorage.getItem(this.storageKey);
                return stored ? JSON.parse(stored) : [];
            }
            
            saveScores() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.scores));
            }
            
            addScore(scoreData) {
                const score = {
                    id: Date.now().toString(),
                    date: new Date().toISOString(),
                    ...scoreData
                };
                
                this.scores.unshift(score);
                this.saveScores();
                return score;
            }
            
            getScores() {
                return this.scores;
            }
            
            getScoresByUser(userId) {
                return this.scores.filter(score => score.userId === userId);
            }
            
            getScoresByTopic(topic) {
                return this.scores.filter(score => score.topic === topic);
            }
            
            clearScores() {
                this.scores = [];
                this.saveScores();
            }
        }

        // Question bank with images
        const questionBank = {
            number: [
                {
                    type: "short-answer",
                    question: "Write the number seven thousand, four hundred and two in digits.",
                    answer: "7402",
                    explanation: "Seven thousand = 7000, four hundred = 400, and two = 2, so 7000 + 400 + 2 = 7402.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 18px; font-weight: bold; color: #4a6ee0;">7,402</div>
                                <div style="font-size: 14px; color: #7f8c8d;">Thousands Hundreds Tens Ones</div>
                                <div style="display: flex; justify-content: center; margin-top: 5px;">
                                    <div style="padding: 5px; margin: 0 2px; background-color: #e8edff; border-radius: 3px;">7</div>
                                    <div style="padding: 5px; margin: 0 2px; background-color: #e8edff; border-radius: 3px;">4</div>
                                    <div style="padding: 5px; margin: 0 2px; background-color: #e8edff; border-radius: 3px;">0</div>
                                    <div style="padding: 5px; margin: 0 2px; background-color: #e8edff; border-radius: 3px;">2</div>
                                </div>
                            </div>
                        </div>
                    `
                },
                {
                    type: "short-answer",
                    question: "Draw a ring around the number that is not a multiple of 4: 16, 26, 32, 48",
                    answer: "26",
                    explanation: "26 is not a multiple of 4 because 26 ÷ 4 = 6.5 (not a whole number).",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Multiples of 4</div>
                                <div style="display: flex; justify-content: center; gap: 10px;">
                                    <div style="padding: 8px; background-color: #d4edda; border-radius: 5px; border: 1px solid #c3e6cb;">16</div>
                                    <div style="padding: 8px; background-color: #f8d7da; border-radius: 5px; border: 1px solid #f5c6cb;">26</div>
                                    <div style="padding: 8px; background-color: #d4edda; border-radius: 5px; border: 1px solid #c3e6cb;">32</div>
                                    <div style="padding: 8px; background-color: #d4edda; border-radius: 5px; border: 1px solid #c3e6cb;">48</div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #e74c3c;">Circle the number that is NOT a multiple of 4</div>
                            </div>
                        </div>
                    `
                },
                {
                    type: "short-answer",
                    question: "Calculate: 70 × 4",
                    answer: "280",
                    explanation: "7 × 4 = 28, then add a zero: 70 × 4 = 280.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">70 × 4 = ?</div>
                                <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                                    <div style="padding: 10px; background-color: #e8edff; border-radius: 5px;">70</div>
                                    <div style="font-size: 20px;">×</div>
                                    <div style="padding: 10px; background-color: #e8edff; border-radius: 5px;">4</div>
                                    <div style="font-size: 20px;">=</div>
                                    <div style="padding: 10px; background-color: #d4edda; border-radius: 5px; min-width: 60px; text-align: center;">?</div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">7 × 4 = 28, then add a zero</div>
                            </div>
                        </div>
                    `
                },
                {
                    type: "short-answer",
                    question: "A model van is one tenth of the size of the real van. The model measures 42 cm. How long is the real van?",
                    answer: "420 cm",
                    explanation: "If model is 1/10 of real size, then real van is 10 × 42 cm = 420 cm.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Scale: 1:10</div>
                                <div style="display: flex; justify-content: center; align-items: flex-end; gap: 20px;">
                                    <div style="text-align: center;">
                                        <div style="width: 60px; height: 30px; background-color: #4a6ee0; border-radius: 5px; margin-bottom: 5px;"></div>
                                        <div style="font-size: 14px;">Model: 42 cm</div>
                                    </div>
                                    <div style="font-size: 20px;">→</div>
                                    <div style="text-align: center;">
                                        <div style="width: 120px; height: 60px; background-color: #3498db; border-radius: 5px; margin-bottom: 5px;"></div>
                                        <div style="font-size: 14px;">Real van: ? cm</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Multiply by 10 to find the real size</div>
                            </div>
                        </div>
                    `
                }
            ],
            sequences: [
                {
                    type: "short-answer",
                    question: "Here is a sequence: 83, 75, 67. What is the next number?",
                    answer: "59",
                    explanation: "The sequence decreases by 8 each time: 83-8=75, 75-8=67, so 67-8=59.",
                    year: "2018",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Sequence Pattern</div>
                                <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                                    <div style="padding: 8px; background-color: #e8edff; border-radius: 5px;">83</div>
                                    <div style="font-size: 16px;">→</div>
                                    <div style="padding: 8px; background-color: #e8edff; border-radius: 5px;">75</div>
                                    <div style="font-size: 16px;">→</div>
                                    <div style="padding: 8px; background-color: #e8edff; border-radius: 5px;">67</div>
                                    <div style="font-size: 16px;">→</div>
                                    <div style="padding: 8px; background-color: #d4edda; border-radius: 5px; min-width: 40px; text-align: center;">?</div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Decreasing by 8 each time</div>
                                <div style="display: flex; justify-content: center; gap: 25px; margin-top: 5px;">
                                    <div style="font-size: 12px; color: #e74c3c;">-8</div>
                                    <div style="font-size: 12px; color: #e74c3c;">-8</div>
                                    <div style="font-size: 12px; color: #e74c3c;">-8</div>
                                </div>
                            </div>
                        </div>
                    `
                },
                {
                    type: "short-answer",
                    question: "Here is a pattern made with dots. The pattern continues in the same way. Diagram 1 has 3 dots, Diagram 2 has 5 dots, Diagram 3 has 7 dots. How many dots in Diagram 9?",
                    answer: "19",
                    explanation: "The pattern increases by 2 dots each time: Diagram n has 2n+1 dots. So Diagram 9 has 2×9+1=19 dots.",
                    year: "2023",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Dot Pattern</div>
                                <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 10px;">
                                    <div style="text-align: center;">
                                        <div>Diagram 1</div>
                                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 5px;">
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                        </div>
                                        <div style="font-size: 12px; margin-top: 5px;">3 dots</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div>Diagram 2</div>
                                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 5px;">
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                        </div>
                                        <div style="font-size: 12px; margin-top: 5px;">5 dots</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div>Diagram 3</div>
                                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 5px;">
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                            <div style="width: 10px; height: 10px; background-color: #4a6ee0; border-radius: 50%;"></div>
                                        </div>
                                        <div style="font-size: 12px; margin-top: 5px;">7 dots</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Pattern: +2 dots each time</div>
                            </div>
                        </div>
                    `
                }
            ],
            fractions: [
                {
                    type: "short-answer",
                    question: "Put these fractions in order, starting with the smallest: 3/10, 8/10, 5/10, 1/10",
                    answer: "1/10, 3/10, 5/10, 8/10",
                    explanation: "With the same denominator, compare numerators: 1/10 < 3/10 < 5/10 < 8/10.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Fraction Bars</div>
                                <div style="display: flex; flex-direction: column; gap: 10px; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="font-size: 14px; min-width: 40px;">1/10</div>
                                        <div class="fraction-diagram" style="width: 150px;">
                                            <div class="fraction-part shaded" style="flex: 1;"></div>
                                            <div class="fraction-part" style="flex: 9;"></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="font-size: 14px; min-width: 40px;">3/10</div>
                                        <div class="fraction-diagram" style="width: 150px;">
                                            <div class="fraction-part shaded" style="flex: 3;"></div>
                                            <div class="fraction-part" style="flex: 7;"></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="font-size: 14px; min-width: 40px;">5/10</div>
                                        <div class="fraction-diagram" style="width: 150px;">
                                            <div class="fraction-part shaded" style="flex: 5;"></div>
                                            <div class="fraction-part" style="flex: 5;"></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="font-size: 14px; min-width: 40px;">8/10</div>
                                        <div class="fraction-diagram" style="width: 150px;">
                                            <div class="fraction-part shaded" style="flex: 8;"></div>
                                            <div class="fraction-part" style="flex: 2;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Order from smallest to largest shaded portion</div>
                            </div>
                        </div>
                    `
                },
                {
                    type: "short-answer",
                    question: "Complete this calculation: 3/4 + ? = 1",
                    answer: "1/4",
                    explanation: "1 = 4/4, and 3/4 + 1/4 = 4/4 = 1.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Fraction Addition</div>
                                <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 15px;">
                                    <div style="text-align: center;">
                                        <div class="fraction-diagram" style="width: 80px; height: 80px;">
                                            <div class="fraction-part shaded" style="flex: 3;"></div>
                                            <div class="fraction-part" style="flex: 1;"></div>
                                        </div>
                                        <div style="font-size: 14px; margin-top: 5px;">3/4</div>
                                    </div>
                                    <div style="font-size: 20px;">+</div>
                                    <div style="text-align: center;">
                                        <div class="fraction-diagram" style="width: 80px; height: 80px;">
                                            <div class="fraction-part" style="flex: 1; background-color: #d4edda;"></div>
                                            <div class="fraction-part" style="flex: 3;"></div>
                                        </div>
                                        <div style="font-size: 14px; margin-top: 5px;">?</div>
                                    </div>
                                    <div style="font-size: 20px;">=</div>
                                    <div style="text-align: center;">
                                        <div class="fraction-diagram" style="width: 80px; height: 80px;">
                                            <div class="fraction-part shaded" style="flex: 4;"></div>
                                        </div>
                                        <div style="font-size: 14px; margin-top: 5px;">1</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">How much more to make a whole?</div>
                            </div>
                        </div>
                    `
                }
            ],
            geometry: [
                {
                    type: "short-answer",
                    question: "Draw all the lines of symmetry on these shapes.",
                    answer: "Rectangle: 2 lines, Square: 4 lines, Triangle: 1 line",
                    explanation: "A rectangle has 2 lines of symmetry, a square has 4, and an isosceles triangle has 1.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Lines of Symmetry</div>
                                <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 10px;">
                                    <div style="text-align: center;">
                                        <div style="width: 80px; height: 50px; border: 2px solid #4a6ee0; position: relative; margin: 0 auto;">
                                            <div class="symmetry-line"></div>
                                            <div class="symmetry-line vertical"></div>
                                        </div>
                                        <div style="font-size: 14px; margin-top: 5px;">Rectangle (2 lines)</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="width: 70px; height: 70px; border: 2px solid #4a6ee0; position: relative; margin: 0 auto;">
                                            <div class="symmetry-line"></div>
                                            <div class="symmetry-line vertical"></div>
                                            <div class="symmetry-line diagonal"></div>
                                            <div class="symmetry-line diagonal-2"></div>
                                        </div>
                                        <div style="font-size: 14px; margin-top: 5px;">Square (4 lines)</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="width: 0; height: 0; border-left: 40px solid transparent; border-right: 40px solid transparent; border-bottom: 70px solid #4a6ee0; position: relative; margin: 0 auto;">
                                            <div class="symmetry-line vertical" style="height: 70px; top: 0;"></div>
                                        </div>
                                        <div style="font-size: 14px; margin-top: 5px;">Triangle (1 line)</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Draw lines where the shape can be folded in half</div>
                            </div>
                        </div>
                    `
                },
                {
                    type: "short-answer",
                    question: "Complete the net of the triangular prism.",
                    answer: "A net with 2 triangles and 3 rectangles",
                    explanation: "A triangular prism has 2 triangular faces and 3 rectangular faces.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Triangular Prism Net</div>
                                <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 5px;">
                                        <div style="width: 40px; height: 40px; background-color: #e8edff; border: 1px solid #4a6ee0; display: flex; justify-content: center; align-items: center;">?</div>
                                        <div style="width: 40px; height: 40px; background-color: #e8edff; border: 1px solid #4a6ee0; display: flex; justify-content: center; align-items: center;">?</div>
                                        <div style="width: 40px; height: 40px; background-color: #e8edff; border: 1px solid #4a6ee0; display: flex; justify-content: center; align-items: center;">?</div>
                                        <div style="width: 40px; height: 40px; background-color: #4a6ee0; border: 1px solid #4a6ee0; display: flex; justify-content: center; align-items: center; color: white;">T</div>
                                        <div style="width: 40px; height: 40px; background-color: #4a6ee0; border: 1px solid #4a6ee0; display: flex; justify-content: center; align-items: center; color: white;">T</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Complete the net with the missing shapes</div>
                            </div>
                        </div>
                    `
                }
            ],
            measurement: [
                {
                    type: "short-answer",
                    question: "A young giraffe is 180 cm tall. His mother is three times as tall. What is the height of the mother giraffe?",
                    answer: "540 cm",
                    explanation: "180 cm × 3 = 540 cm.",
                    year: "2018",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Giraffe Heights</div>
                                <div style="display: flex; justify-content: center; align-items: flex-end; gap: 20px;">
                                    <div style="text-align: center;">
                                        <div style="width: 30px; height: 90px; background-color: #4a6ee0; border-radius: 5px; margin-bottom: 5px;"></div>
                                        <div style="font-size: 14px;">Young: 180 cm</div>
                                    </div>
                                    <div style="font-size: 20px;">×3</div>
                                    <div style="text-align: center;">
                                        <div style="width: 40px; height: 180px; background-color: #3498db; border-radius: 5px; margin-bottom: 5px;"></div>
                                        <div style="font-size: 14px;">Mother: ? cm</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Multiply by 3 to find the mother's height</div>
                            </div>
                        </div>
                    `
                },
                {
                    type: "short-answer",
                    question: "What temperature does the thermometer show? (Thermometer shows between 0°C and 10°C)",
                    answer: "5°C",
                    explanation: "The thermometer shows halfway between 0°C and 10°C, which is 5°C.",
                    year: "2014",
                    image: `
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="display: inline-block; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f8f9fa;">
                                <div style="font-size: 16px; margin-bottom: 10px;">Thermometer</div>
                                <div class="thermometer">
                                    <div class="thermometer-mercury" style="height: 50%;"></div>
                                    <div class="thermometer-mark" style="top: 0%;"></div>
                                    <div class="thermometer-label" style="top: 0%;">10°C</div>
                                    <div class="thermometer-mark" style="top: 50%;"></div>
                                    <div class="thermometer-label" style="top: 50%;">5°C</div>
                                    <div class="thermometer-mark" style="top: 100%;"></div>
                                    <div class="thermometer-label" style="top: 100%;">0°C</div>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">Read the temperature at the red line</div>
                            </div>
                        </div>
                    `
                }
            ]
        };

        // DOM elements
        const generateBtn = document.getElementById('generateBtn');
        const printBtn = document.getElementById('printBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const checkAnswersBtn = document.getElementById('checkAnswersBtn');
        const viewScoresBtn = document.getElementById('viewScoresBtn');
        const worksheet = document.getElementById('worksheet');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const scoresContainer = document.getElementById('scoresContainer');
        const topicSelect = document.getElementById('topic');
        const difficultySelect = document.getElementById('difficulty');
        const questionCountInput = document.getElementById('questionCount');
        const yearSelect = document.getElementById('year');
        const userNameInput = document.getElementById('userName');
        const userIdInput = document.getElementById('userId');
        const nameError = document.getElementById('nameError');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Initialize score tracker
        const scoreTracker = new ScoreTracker();

        // Store current questions for answer checking
        let currentQuestions = [];
        let currentTopic = 'all';

        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active tab content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
                
                // If switching to scores tab, refresh the scores display
                if (tabId === 'scores') {
                    displayScores();
                }
            });
        });

        // Generate worksheet function
        function generateWorksheet() {
            const userName = userNameInput.value.trim();
            
            // Validate student name
            if (!userName) {
                nameError.classList.remove('hidden');
                return;
            }
            
            nameError.classList.add('hidden');
            
            const selectedTopic = topicSelect.value;
            const questionCount = parseInt(questionCountInput.value);
            const selectedYear = yearSelect.value;
            currentTopic = selectedTopic;
            
            // Clear previous worksheet
            worksheet.innerHTML = '';
            scoreDisplay.innerHTML = '';
            scoreDisplay.classList.add('hidden');
            
            // Select questions based on topic and year
            let questions = [];
            if (selectedTopic === 'all') {
                // Combine questions from all topics
                for (const topic in questionBank) {
                    questions = questions.concat(questionBank[topic]);
                }
            } else {
                questions = questionBank[selectedTopic];
            }
            
            // Filter by year if specified
            if (selectedYear !== 'all') {
                questions = questions.filter(q => q.year === selectedYear);
            }
            
            // Shuffle questions and select the requested number
            const shuffledQuestions = shuffleArray([...questions]);
            currentQuestions = shuffledQuestions.slice(0, Math.min(questionCount, shuffledQuestions.length));
            
            // Add unit headers if showing all topics
            if (selectedTopic === 'all') {
                addUnitHeaders(currentQuestions);
            } else {
                // Just add the questions
                currentQuestions.forEach((q, index) => {
                    addQuestionToWorksheet(q, index + 1);
                });
            }
            
            // Show worksheet and action buttons
            worksheet.classList.remove('hidden');
            printBtn.classList.remove('hidden');
            downloadBtn.classList.remove('hidden');
            checkAnswersBtn.classList.remove('hidden');
        }

        // Add unit headers for better organization when showing all topics
        function addUnitHeaders(questions) {
            let currentUnit = '';
            let questionNumber = 1;
            
            questions.forEach(q => {
                // Determine which unit this question belongs to
                let unit = '';
                if (questionBank.number.includes(q)) unit = 'Number & Place Value';
                else if (questionBank.sequences.includes(q)) unit = 'Sequences & Patterns';
                else if (questionBank.fractions.includes(q)) unit = 'Fractions';
                else if (questionBank.geometry.includes(q)) unit = 'Geometry & Shapes';
                else if (questionBank.measurement.includes(q)) unit = 'Measurement';
                else if (questionBank.statistics.includes(q)) unit = 'Statistics & Probability';
                
                // Add unit header if it's different from the current one
                if (unit && unit !== currentUnit) {
                    const unitHeader = document.createElement('div');
                    unitHeader.className = 'unit-header';
                    unitHeader.textContent = unit;
                    worksheet.appendChild(unitHeader);
                    currentUnit = unit;
                }
                
                // Add the question
                addQuestionToWorksheet(q, questionNumber);
                questionNumber++;
            });
        }

        // Add a question to the worksheet
        function addQuestionToWorksheet(question, number) {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.id = `question-${number}`;
            
            const questionNumber = document.createElement('div');
            questionNumber.className = 'question-number';
            questionNumber.textContent = `${number}. (${question.year})`;
            questionDiv.appendChild(questionNumber);
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.innerHTML = question.question;
            questionDiv.appendChild(questionText);
            
            // Add image if the question has one
            if (question.image) {
                const imageDiv = document.createElement('div');
                imageDiv.innerHTML = question.image;
                questionDiv.appendChild(imageDiv);
            }
            
            // Add input for answer
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'answer-input';
            input.placeholder = 'Your answer here...';
            input.id = `answer-${number}`;
            questionDiv.appendChild(input);
            
            // Add feedback area
            const feedback = document.createElement('div');
            feedback.className = 'feedback hidden';
            feedback.id = `feedback-${number}`;
            questionDiv.appendChild(feedback);
            
            worksheet.appendChild(questionDiv);
        }

        // Check answers function
        function checkAnswers() {
            let correctCount = 0;
            
            currentQuestions.forEach((question, index) => {
                const questionNumber = index + 1;
                const feedback = document.getElementById(`feedback-${questionNumber}`);
                feedback.classList.remove('correct', 'incorrect', 'hidden');
                
                const userAnswer = document.getElementById(`answer-${questionNumber}`).value.trim();
                
                // Normalize answer for comparison
                const normalizedUserAnswer = userAnswer.toLowerCase().replace(/\s+/g, '');
                const normalizedCorrectAnswer = question.answer.toString().toLowerCase().replace(/\s+/g, '');
                
                const isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
                
                if (isCorrect) {
                    feedback.textContent = `✓ Correct! ${question.explanation || ''}`;
                    feedback.classList.add('correct');
                    correctCount++;
                } else {
                    feedback.textContent = `✗ Incorrect. The correct answer is: ${question.answer}. ${question.explanation || ''}`;
                    feedback.classList.add('incorrect');
                }
            });
            
            // Calculate score
            const scorePercentage = Math.round((correctCount / currentQuestions.length) * 100);
            
            // Save score to backend
            const userName = userNameInput.value || 'Anonymous';
            const userId = userIdInput.value || 'unknown';
            
            const scoreData = {
                userName: userName,
                userId: userId,
                topic: currentTopic,
                score: scorePercentage,
                correctAnswers: correctCount,
                totalQuestions: currentQuestions.length,
                date: new Date().toLocaleString()
            };
            
            scoreTracker.addScore(scoreData);
            
            // Display score
            scoreDisplay.innerHTML = `
                <h3>Your Score: ${correctCount}/${currentQuestions.length} (${scorePercentage}%)</h3>
                <p>${getScoreMessage(scorePercentage)}</p>
                <p>Score saved to your history.</p>
            `;
            scoreDisplay.classList.remove('hidden');
        }

        // Download worksheet as PDF
        function downloadWorksheetAsPDF() {
            const userName = userNameInput.value.trim() || 'Student';
            const topic = topicSelect.options[topicSelect.selectedIndex].text;
            const date = new Date().toLocaleDateString();
            
            // Create a new element for PDF content
            const pdfContent = document.createElement('div');
            pdfContent.style.padding = '20px';
            pdfContent.style.fontFamily = 'Arial, sans-serif';
            pdfContent.style.fontSize = '14px';
            pdfContent.style.lineHeight = '1.5';
            pdfContent.style.color = '#333';
            
            // Add header
            const header = document.createElement('div');
            header.style.textAlign = 'center';
            header.style.marginBottom = '20px';
            header.style.paddingBottom = '10px';
            header.style.borderBottom = '2px solid #4a6ee0';
            
            const title = document.createElement('h1');
            title.textContent = 'Cambridge Stage 4 Math Worksheet';
            title.style.color = '#2c3e50';
            title.style.marginBottom = '5px';
            title.style.fontSize = '24px';
            
            const subtitle = document.createElement('p');
            subtitle.textContent = 'Based on Cambridge Primary Progression Tests';
            subtitle.style.color = '#7f8c8d';
            subtitle.style.fontSize = '16px';
            
            header.appendChild(title);
            header.appendChild(subtitle);
            pdfContent.appendChild(header);
            
            // Add student info
            const studentInfo = document.createElement('div');
            studentInfo.style.marginBottom = '20px';
            studentInfo.style.padding = '10px';
            studentInfo.style.backgroundColor = '#f8f9fa';
            studentInfo.style.borderRadius = '5px';
            
            studentInfo.innerHTML = `
                <p><strong>Student:</strong> ${userName}</p>
                <p><strong>Topic:</strong> ${topic}</p>
                <p><strong>Date:</strong> ${date}</p>
            `;
            
            pdfContent.appendChild(studentInfo);
            
            // Add questions
            currentQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.style.marginBottom = '20px';
                questionDiv.style.paddingBottom = '15px';
                questionDiv.style.borderBottom = '1px dashed #ddd';
                
                const questionNumber = document.createElement('div');
                questionNumber.textContent = `${index + 1}. (${question.year})`;
                questionNumber.style.fontWeight = 'bold';
                questionNumber.style.marginBottom = '8px';
                questionNumber.style.color = '#4a6ee0';
                
                const questionText = document.createElement('div');
                questionText.innerHTML = question.question;
                questionText.style.marginBottom = '10px';
                
                questionDiv.appendChild(questionNumber);
                questionDiv.appendChild(questionText);
                
                // Add image if the question has one
                if (question.image) {
                    const imageDiv = document.createElement('div');
                    imageDiv.innerHTML = question.image;
                    questionDiv.appendChild(imageDiv);
                }
                
                // Add answer space
                const answerSpace = document.createElement('div');
                answerSpace.style.height = '25px';
                answerSpace.style.borderBottom = '1px solid #ddd';
                answerSpace.style.marginTop = '10px';
                
                questionDiv.appendChild(answerSpace);
                
                pdfContent.appendChild(questionDiv);
            });
            
            // Append to body temporarily
            document.body.appendChild(pdfContent);
            
            // Generate PDF
            const options = {
                margin: 10,
                filename: `Cambridge_Math_Worksheet_${userName.replace(/\s+/g, '_')}_${date.replace(/\//g, '-')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    width: pdfContent.scrollWidth,
                    height: pdfContent.scrollHeight
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait' 
                }
            };
            
            // Generate PDF with a small delay to ensure rendering
            setTimeout(() => {
                html2pdf().set(options).from(pdfContent).save().then(() => {
                    // Remove the temporary element after PDF generation
                    document.body.removeChild(pdfContent);
                }).catch(error => {
                    console.error('PDF generation failed:', error);
                    document.body.removeChild(pdfContent);
                    alert('PDF generation failed. Please try again.');
                });
            }, 100);
        }

        // Display scores in the scores tab
        function displayScores() {
            const scores = scoreTracker.getScores();
            scoresContainer.innerHTML = '';
            
            if (scores.length === 0) {
                scoresContainer.innerHTML = '<div class="no-scores">No scores recorded yet. Complete a worksheet to see your scores here.</div>';
                return;
            }
            
            scores.forEach(score => {
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card';
                
                scoreCard.innerHTML = `
                    <div class="score-header">
                        <div class="score-topic">${score.userName} - ${score.topic === 'all' ? 'All Topics' : score.topic}</div>
                        <div class="score-date">${score.date}</div>
                    </div>
                    <div class="score-details">
                        <div class="score-value">${score.score}%</div>
                        <div>${score.correctAnswers}/${score.totalQuestions} correct</div>
                    </div>
                `;
                
                scoresContainer.appendChild(scoreCard);
            });
        }

        // Get motivational message based on score
        function getScoreMessage(percentage) {
            if (percentage >= 90) return "Excellent work! You've mastered these concepts!";
            if (percentage >= 80) return "Great job! You have a strong understanding of these topics.";
            if (percentage >= 70) return "Good work! You understand most of these concepts.";
            if (percentage >= 60) return "Not bad! Review the incorrect answers to improve.";
            return "Keep practicing! Review the material and try again.";
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Event listeners
        generateBtn.addEventListener('click', generateWorksheet);
        
        printBtn.addEventListener('click', () => {
            window.print();
        });
        
        downloadBtn.addEventListener('click', downloadWorksheetAsPDF);
        
        checkAnswersBtn.addEventListener('click', checkAnswers);
        
        viewScoresBtn.addEventListener('click', () => {
            // Switch to scores tab
            tabs.forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="scores"]').classList.add('active');
            
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === 'scores-tab') {
                    content.classList.add('active');
                }
            });
            
            displayScores();
        });

        // Initialize scores display
        displayScores();
    </script>
</body>
</html>
